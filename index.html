<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Korean Trainer ‚Äì Clean UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    background: #0f172a;
    color: #e2e8f0;
    font-family: "Inter", sans-serif;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
    font-weight: 700;
  }

  .container {
    max-width: 900px;
    margin: auto;
  }

  .card {
    background: #1e293b;
    padding: 20px;
    border-radius: 14px;
    margin-bottom: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.25);
    transition: 0.3s ease;
  }

  .card:hover {
    transform: translateY(-2px);
  }

  input, select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    background: #0f172a;
    border: 1px solid #334155;
    color: white;
    margin-top: 8px;
    font-size: 1rem;
  }

  button {
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    background: #6366f1;
    color: white;
    cursor: pointer;
    font-size: 1rem;
    margin-top: 12px;
    transition: 0.2s ease;
  }

  button:hover {
    background: #4f46e5;
  }

  button.secondary {
    background: #334155;
  }

  .korean-word {
    font-size: 2.4rem;
    margin: 10px 0;
    font-weight: 700;
  }

  .info {
    margin: 6px 0;
    opacity: 0.8;
  }

  .label {
    font-size: 0.9rem;
    opacity: 0.8;
    margin-top: 8px;
  }

  .hidden {
    display: none;
  }

  .result-correct { color: #4ade80; font-weight: 600; }
  .result-wrong { color: #f87171; font-weight: 600; }

  .reveal-box {
    margin-top: 10px;
    padding: 10px;
    background: #0f172a;
    border-radius: 8px;
    border: 1px solid #334155;
    font-size: 1.1rem;
  }
</style>
</head>

<body>
<h1>üá∞üá∑ Korean Learning App</h1>

<div class="container">

  <!-- API KEY CARD -->
  <div class="card">
    <h2>Step 0: Enter KRDict API Key</h2>
    <input id="apiKey" placeholder="Paste KRDict API Key" />
    <button onclick="saveKey()">Save Key</button>
    <div id="keyStatus"></div>
  </div>

  <!-- LEARN CARD -->
  <div class="card">
    <h2>1. Learn a New Word</h2>

    <div class="korean-word" id="word">‚Äî</div>
    <button onclick="speakKorean()">üîä Speak</button>

    <div class="info" id="pron"></div>
    <div class="info" id="pos"></div>
    <div class="info" id="definition"></div>
    <div class="info" id="englishWord"></div>

    <button onclick="loadWord()">Get New Word</button>
    <div id="learnStatus"></div>
  </div>

  <!-- QUIZ CARD -->
  <div class="card">
    <h2>2. Quiz Yourself</h2>

    <label class="label">Quiz Mode:</label>
    <select id="quizMode">
      <option value="ko-en">Korean ‚Üí English</option>
      <option value="en-ko">English ‚Üí Korean</option>
    </select>

    <h2 id="quizPrompt" style="margin-top:15px;">‚Äî</h2>

    <input id="quizInput" placeholder="Type your answer..." />

    <button onclick="checkQuiz()">Check Answer</button>
    <button class="secondary" onclick="reveal()">Reveal Answer</button>

    <p id="quizResult"></p>

    <div class="reveal-box hidden" id="answerBox">
      <strong id="correctAnswer">‚Äî</strong>
    </div>
  </div>

</div>

<script>
let API_KEY = "";
let current = null;

// LOAD API KEY
(function(){
  const stored = localStorage.getItem("KRDICT_KEY");
  if (stored) {
    API_KEY = stored;
    document.getElementById("apiKey").value = stored;
  }
})();

function saveKey() {
  API_KEY = document.getElementById("apiKey").value.trim();
  localStorage.setItem("KRDICT_KEY", API_KEY);
  document.getElementById("keyStatus").textContent = "API Key Saved!";
}

// ---------- TEXT TO SPEECH ----------
function speakKorean() {
  if (!current) return;
  let u = new SpeechSynthesisUtterance(current.word);
  u.lang = "ko-KR";
  speechSynthesis.speak(u);
}

// ---------- LOAD WORD ----------
async function loadWord() {
  if (!API_KEY) return alert("Enter API key first!");

  document.getElementById("learnStatus").textContent = "Loading...";

  const seeds = ["ÏÇ¨Îûë", "ÌïôÍµê", "ÏπúÍµ¨", "ÏùåÏãù", "Ï¢ãÎã§", "Ïò§Îäò"];
  const seed = seeds[Math.floor(Math.random() * seeds.length)];

  const url =
    `https://krdict.korean.go.kr/api/search?key=${API_KEY}&q=${seed}&translated=y&trans_lang=1&sort=popular&num=10`;

  const xml = await fetch(url).then(r => r.text());
  const doc = new DOMParser().parseFromString(xml, "text/xml");
  const items = [...doc.getElementsByTagName("item")];

  if (!items.length) return alert("No word found.");

  const it = items[Math.floor(Math.random() * items.length)];

  function tx(tag) {
    const el = it.getElementsByTagName(tag)[0];
    return el ? el.textContent.trim() : "";
  }

  let english = "";
  let transWord = it.getElementsByTagName("trans_word")[0];
  if (transWord) english = transWord.textContent.trim().toLowerCase();

  if (!english) english = tx("trans_dfn").split(" ")[0];

  current = {
    word: tx("word"),
    pron: tx("pronunciation"),
    pos: tx("pos"),
    definition: tx("definition"),
    english: english
  };

  // UPDATE UI
  document.getElementById("word").textContent = current.word;
  document.getElementById("pron").textContent = "Pronunciation: " + current.pron;
  document.getElementById("pos").textContent = "Part of Speech: " + current.pos;
  document.getElementById("definition").textContent = current.definition;
//   document.getElementById("englishWord").textContent = "English: " + english;

  document.getElementById("learnStatus").textContent = "";

  // AUTO SEND TO QUIZ
  setQuizWord();
}

// ---------- QUIZ SETUP ----------
function setQuizWord() {
  const mode = document.getElementById("quizMode").value;

  if (mode === "ko-en") {
    document.getElementById("quizPrompt").textContent = current.word;
    document.getElementById("correctAnswer").textContent = current.english;
  } else {
    document.getElementById("quizPrompt").textContent = current.english;
    document.getElementById("correctAnswer").textContent = current.word;
  }

  // Reset quiz UI
  document.getElementById("quizResult").textContent = "";
  document.getElementById("answerBox").classList.add("hidden");
  document.getElementById("quizInput").value = "";
}

// Change quiz mode instantly
document.getElementById("quizMode").addEventListener("change", setQuizWord);

// ---------- CHECK ANSWER ----------
function checkQuiz() {
  const ans = document.getElementById("quizInput").value.trim().toLowerCase();
  const correct = document.getElementById("correctAnswer").textContent.trim().toLowerCase();

  if (!ans) return;

  if (ans === correct) {
    document.getElementById("quizResult").textContent = "‚úÖ Correct!";
    document.getElementById("quizResult").className = "result-correct";
  } else {
    document.getElementById("quizResult").textContent = "‚ùå Incorrect!";
    document.getElementById("quizResult").className = "result-wrong";
  }
}

// ---------- REVEAL ANSWER ----------
function reveal() {
  document.getElementById("answerBox").classList.remove("hidden");
}
</script>

</body>
</html>
